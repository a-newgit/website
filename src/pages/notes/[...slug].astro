---
import PageLayout from "../../layouts/PageLayout.astro";
import Prose from "../../components/Prose.astro";
import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
  const notes = await getCollection("notes");
  return notes.map((note) => ({
    params: { slug: note.id },
    props: { note },
  }));
}

const { note } = Astro.props;
const { Content } = await render(note);

const formattedDate = note.data.pubDate.toLocaleDateString("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
});
---

<PageLayout title={note.data.title} description={note.data.description}>
  <article class="note">
    <header class="note-header">
      <time class="note-date" datetime={note.data.pubDate.toISOString()}>
        {formattedDate}
      </time>
      <h1 class="note-title">{note.data.title}</h1>
      {
        note.data.tags.length > 0 && (
          <div class="note-tags">
            {note.data.tags.map((tag) => (
              <span class="note-tag">{tag}</span>
            ))}
          </div>
        )
      }
    </header>

    <Prose>
      <Content />
    </Prose>

    <footer class="note-footer">
      <a href="/notes" class="back-link">&larr; Back to notes</a>
    </footer>
  </article>
</PageLayout>

<style>
  .note-header {
    margin-bottom: var(--space-10);
  }

  .note-date {
    font-family: var(--font-mono);
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    display: block;
    margin-bottom: var(--space-3);
  }

  .note-title {
    font-size: var(--text-3xl);
    margin-bottom: var(--space-4);
    line-height: 1.2;
  }

  .note-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
  }

  .note-tag {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--color-text-muted);
    background-color: var(--color-bg-alt);
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-sm);
  }

  .note-footer {
    margin-top: var(--space-12);
    padding-top: var(--space-6);
    border-top: 1px solid var(--color-border-subtle);
  }

  .back-link {
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
    text-decoration: none;
  }

  .back-link:hover {
    color: var(--color-text);
  }
</style>
